<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åˆ—è½¦åˆ°ç«™æ—¶é—´è¡¨</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th,
        td {
            border: 1px solid #ddd;
            padding: 8px;
        }

        th {
            background-color: #f2f2f2;
            text-align: left;
        }

       .time-remaining {
            font-weight: bold;
            color: #2ADC25;
        }

       .arriving-soon {
            background-color: #808080;
        }
    </style>
</head>

<body>
    <!-- 3å·çº¿è¡¨æ ¼å¼€å§‹ 
    <h5>  å¼€å‘è€…ï¼šNFLS-lyx,NFLS-xcx</h5>
    <h5>  æµ‹è¯•äººå‘˜ï¼šNFLS-xxy,ğ–´ğ—‡ğ—‚ğ–²ğ–¾ğ–¯ğ–³-Furry</h5>
     æ•°æ®å°†ç”±JavaScriptåŠ¨æ€å¡«å…… 
    <h1>3å·çº¿ é¸¡é¸£å¯º</h1>
    <table>
        <thead>
            <tr>
                <th>ç»ˆç‚¹ç«™</th>
                <th>åˆ°ç«™æ—¶é—´</th>
                <th>çŠ¶æ€</th>
                <th>äº¤è·¯æ¨¡å¼</th>
                <th>åˆ—è½¦çŠ¶æ€</th>
            </tr>
        </thead>
        <tbody id="train-table-body-3">
             æ•°æ®å°†ç”±JavaScriptåŠ¨æ€å¡«å…… -->
        </tbody>
    </table>
    <!-- 3å·çº¿è¡¨æ ¼ç»“æŸ -->

    <!-- 4å·çº¿è¡¨æ ¼å¼€å§‹ -->
    <h1>4å·çº¿ äº‘å—è·¯</h1>

    <table>
        <thead>
            <tr>
                <th>ç»ˆç‚¹ç«™</th>
                <th>åˆ°ç«™æ—¶é—´</th>
                <th>çŠ¶æ€</th>
                <th>äº¤è·¯æ¨¡å¼</th>
                <th>åˆ—è½¦çŠ¶æ€</th>
            </tr>
        </thead>
        <tbody id="train-table-body">
            <!-- æ•°æ®å°†ç”±JavaScriptåŠ¨æ€å¡«å…… -->
        </tbody>
    </table>
    <!-- 4å·çº¿è¡¨æ ¼ç»“æŸ -->

    <script type="module">
        import arrivalTimes4 from "../../beautified_js/äº‘å—è·¯_4.js";
   
        //import arrivalTimes3 from "../../beautified_js/é¸¡é¸£å¯º_3.js";

        // è·å–å½“å‰æ—¥æœŸçš„æ˜ŸæœŸå‡ 
        function getWeekDay() {
            const now = new Date();
            return now.getDay();
        }

        // æ ¹æ®æ˜ŸæœŸå‡ é€‰æ‹©ç›¸åº”çš„æ•°æ®ï¼ˆ4å·çº¿ï¼‰
        function getArrivalTimesForToday4() {
            const weekDay = getWeekDay();
            console.log(`Today is day: ${weekDay}`);

            const arrivalTimesForToday = {
                0: arrivalTimes4.sunday,
                1: arrivalTimes4.monday,
                2: arrivalTimes4.tuesday,
                3: arrivalTimes4.wednesday,
                4: arrivalTimes4.thursday,
                5: arrivalTimes4.friday,
                6: arrivalTimes4.saturday,
            }[weekDay] || [];

            console.log("Arrival times for today:", arrivalTimesForToday);
            return Array.isArray(arrivalTimesForToday)? arrivalTimesForToday : [];
        }

        // æ ¹æ®æ˜ŸæœŸå‡ é€‰æ‹©ç›¸åº”çš„æ•°æ®ï¼ˆ3å·çº¿ï¼‰
      /*  function getArrivalTimesForToday3() {
            const weekDay = getWeekDay();
            console.log(`Today is day: ${weekDay}`);

            const arrivalTimesForToday = {
                0: arrivalTimes3.sunday,
                1: arrivalTimes3.monday,
                2: arrivalTimes3.tuesday,
                3: arrivalTimes3.wednesday,
                4: arrivalTimes3.thursday,
                5: arrivalTimes3.friday,
                6: arrivalTimes3.saturday,
            }[weekDay] || [];

            console.log("Arrival times for today 3:", arrivalTimesForToday);
            return Array.isArray(arrivalTimesForToday)? arrivalTimesForToday : [];
        }*/

        function padTime(number) {
            return String(number).padStart(2, '0');
        }

        function getCurrentTimeString() {
            const now = new Date();
            return `${padTime(now.getHours())}:${padTime(now.getMinutes())}:${padTime(now.getSeconds())}`;
        }

        function parseTimeString(timeString) {
            const [hours, minutes, seconds] = timeString.split(':').map(Number);
            return { hours, minutes, seconds };
        }

        function calculateTimeRemaining(arrivalTime, currentTime) {
            const { hours: arrivalHours, minutes: arrivalMinutes, seconds: arrivalSeconds } = arrivalTime;
            const { hours: currentHours, minutes: currentMinutes, seconds: currentSeconds } = currentTime;

            const arrivalTotalSeconds = arrivalHours * 3600 + arrivalMinutes * 60 + arrivalSeconds;
            const currentTotalSeconds = currentHours * 3600 + currentMinutes * 60 + currentSeconds;

            let timeRemainingSeconds = arrivalTotalSeconds - currentTotalSeconds;
            if (timeRemainingSeconds < 0) {
                timeRemainingSeconds += 24 * 3600;
            }

            const hours = Math.floor(timeRemainingSeconds / 3600);
            timeRemainingSeconds %= 3600;
            const minutes = Math.floor(timeRemainingSeconds / 60);
            const seconds = Math.floor(timeRemainingSeconds % 60);

            return {
                hours,
                minutes,
                seconds,
                totalSeconds: arrivalTotalSeconds - currentTotalSeconds,
                timeString: `${padTime(hours)}å°æ—¶ ${padTime(minutes)}åˆ†é’Ÿ ${padTime(seconds)}ç§’`
            };
        }

        function updateTable(tableId, arrivalTimesForToday) {
            const tableBody = document.getElementById(tableId);
            tableBody.innerHTML = '';

            const currentTimeString = getCurrentTimeString();
            console.log(`Current time: ${currentTimeString}`);
            const currentTime = parseTimeString(currentTimeString);

            if (arrivalTimesForToday.length === 0) {
                console.log("No arrival times available for today.");
                return;
            }

            // è¿‡æ»¤æ‰å·²ç»è¿‡ç«™çš„åˆ—è½¦å’Œåˆ°ç«™æ—¶é—´è¶…è¿‡30åˆ†é’Ÿçš„åˆ—è½¦
            const filteredArrivalTimes = arrivalTimesForToday.filter(train => {
                const arrivalTime = parseTimeString(train.time);
                const timeRemaining = calculateTimeRemaining(arrivalTime, currentTime);
                const arrivalTotalSeconds = arrivalTime.hours * 3600 + arrivalTime.minutes * 60 + arrivalTime.seconds;
                const currentTotalSeconds = currentTime.hours * 3600 + currentTime.minutes * 60 + currentTime.seconds;

                return arrivalTotalSeconds > currentTotalSeconds && timeRemaining.totalSeconds <= 1800;
            });

            console.log(`Filtered arrival times:`, filteredArrivalTimes);

            // è®¡ç®—å‰©ä½™æ—¶é—´å¹¶æ’åº
            const sortedArrivalTimes = filteredArrivalTimes.map(train => ({
               ...train,
                timeRemaining: calculateTimeRemaining(parseTimeString(train.time), currentTime)
            })).sort((a, b) => a.timeRemaining.hours * 3600 + a.timeRemaining.minutes * 60 + a.timeRemaining.seconds -
                (b.timeRemaining.hours * 3600 + b.timeRemaining.minutes * 60 + b.timeRemaining.seconds));

            console.log(`Sorted arrival times:`, sortedArrivalTimes);

            sortedArrivalTimes.forEach(train => {
                const row = document.createElement('tr');

                const destinationCell = document.createElement('td');
                destinationCell.textContent = train.destination;
                row.appendChild(destinationCell);

                const arrivalTimeCell = document.createElement('td');
                arrivalTimeCell.textContent = train.time;
                row.appendChild(arrivalTimeCell);

                const timeRemainingCell = document.createElement('td');
                timeRemainingCell.className = 'time-remaining';
                timeRemainingCell.textContent = train.timeRemaining.timeString;
                row.appendChild(timeRemainingCell);

                const jiaoluCell = document.createElement('td');
                jiaoluCell.textContent = train.jiaolu;
                row.appendChild(jiaoluCell);

                const statusCell = document.createElement('td');
                statusCell.textContent = 'æ­£å¸¸';
                row.appendChild(statusCell);

                row.classList.remove('arriving-soon');

                if (train.timeRemaining.totalSeconds <= 60 && train.timeRemaining.totalSeconds > 0) {
                    row.classList.add('arriving-soon');
                    statusCell.textContent = 'å³å°†è¿›ç«™';
                }

                let statusUpdated = false;

                function updateStatus() {
                    if (train.timeRemaining.totalSeconds > 0) {
                        if (train.timeRemaining.totalSeconds <= 60) {6
                            statusCell.textContent = 'å³å°†è¿›ç«™';
                            row.classList.add('arriving-soon');
                        } else {
                            statusCell.textContent = 'æ­£å¸¸';
                            row.classList.remove('arriving-soon');
                        }
                    } else {
                        if (train.timeRemaining.totalSeconds === 0) {
                            statusUpdated = true;
                            statusCell.textContent = 'æ­£åœ¨ç¦»å¼€';
                            setTimeout(() => {
                                row.style.display = 'none';
                            }, 5000);
                        }
                    }
                }

                // æ¯ç§’æ›´æ–°çŠ¶æ€åˆ—
                const intervalId = setInterval(() => {
                    if (!statusUpdated) {
                        train.timeRemaining.totalSeconds--;
                        timeRemainingCell.textContent = `${padTime(Math.floor(train.timeRemaining.totalSeconds / 3600))}å°æ—¶ ${padTime(Math.floor((train.timeRemaining.totalSeconds % 3600) / 60))}åˆ†é’Ÿ ${padTime(train.timeRemaining.totalSeconds % 60)}ç§’`;
                        updateStatus();
                    } else {
                        clearInterval(intervalId);
                    }
                }, 1000);

                updateStatus();
                tableBody.appendChild(row);
            });
        }

        // åˆå§‹æ›´æ–°è¡¨æ ¼
        //updateTable('train-table-body-3', getArrivalTimesForToday3());
        updateTable('train-table-body', getArrivalTimesForToday4());
    </script>
</body>

</html>